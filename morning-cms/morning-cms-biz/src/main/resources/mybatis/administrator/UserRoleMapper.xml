<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pussinboots.morning.cms.modules.administrator.mapper.UserRoleMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.pussinboots.morning.cms.modules.administrator.entity.UserRole">
		<id column="user_role_id" property="userRoleId" />
		<result column="role_id" property="roleId" />
		<result column="user_id" property="userId" />
		<result column="create_time" property="createTime" />
		<result column="create_by" property="createBy" />
	</resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        user_role_id AS userRoleId, role_id AS roleId, user_id AS userId, create_time AS createTime, create_by AS createBy
    </sql>
    
    <!-- 插入用户角色记录 -->
    <insert id="insertUserRoles" parameterType="java.util.List">
    	InSERT INTO cms_user_role(
   			role_id, 
    		user_id, 
    		create_time, 
    		create_by
    	)VALUES
    	<foreach collection="userRoles" item="userRole" separator=",">
    	(
	     	#{userRole.roleId},
	     	#{userRole.userId},
	        #{userRole.createTime}, 
	        #{userRole.createBy}    		
    	)
    	</foreach>
    </insert>    
    
    <!-- 根据管理员ID查找角色ID列表 -->
    <select id="selectRoleIdsByUserId" resultType="java.lang.Long" parameterType="java.lang.Long">
    	SELECT
    		role_id AS roleId
    	FROM
    		cms_user_role
    	WHERE
    		user_id = #{userId}
    </select>
    
    <!-- 根据管理员ID和角色状态查找角色列表 -->
    <select id="selectRolesByUserId" resultType="Role">
    	SELECT
        	r.role_id AS roleId, 
        	role_name AS roleName, 
        	role_sign as roleSign
		FROM
			cms_role r
		LEFT JOIN
			cms_user_role u ON r.role_id = u.role_id
		<where>
			1=1
			<if test="status != null">
				AND status = #{status}
			</if>
			<if test="userId != null">
				AND u.user_id = #{userId}
			</if>
		</where>
    </select>
    
    <!-- 根据角色ID查找用户列表 -->
    <select id="selectUsersByRoleId" resultType="User">
		SELECT 
			u.user_id AS userId,
			login_name AS loginName,
			login_password AS loginPassword,
			user_name AS userName,
			real_name AS realName,
			sex,
			age,
			pic_img AS picImg,
			STATUS,
			email,
			telephone,
			last_login_time AS lastLoginTime,
			last_login_ip AS lastLoginIp,
			u.create_time AS createTime,
			u.create_by AS createBy,
			u.update_time AS updateTime,
			u.update_by AS updateBy
		FROM
			cms_user_role r
		LEFT JOIN
			cms_user u ON r.user_id = u.user_id
		WHERE
			role_id = #{roleId}
    </select>
    
</mapper>
